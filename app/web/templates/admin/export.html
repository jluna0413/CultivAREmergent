{% extends 'common/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block header %}
    <div class="header-content">
        <h1><i class="fas fa-download"></i> Data Export & Backup</h1>
        <p>Export and backup your CultivAR data</p>
    </div>
{% endblock %}

{% block content %}
<div class="export-container">
    <!-- Export Statistics -->
    <div class="stats-section">
        <h2><i class="fas fa-chart-bar"></i> Data Overview</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon plant-icon">
                    <i class="fas fa-seedling"></i>
                </div>
                <div class="stat-info">
                    <h3>{{ export_stats.total_plants }}</h3>
                    <p>Total Plants</p>
                    <small>{{ export_stats.living_plants }} living, {{ export_stats.harvested_plants }} harvested</small>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon strain-icon">
                    <i class="fas fa-dna"></i>
                </div>
                <div class="stat-info">
                    <h3>{{ export_stats.total_strains }}</h3>
                    <p>Total Strains</p>
                    <small>{{ export_stats.in_stock_strains }} in stock, {{ export_stats.out_of_stock_strains }} out of stock</small>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon activity-icon">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="stat-info">
                    <h3>{{ export_stats.total_activities }}</h3>
                    <p>Total Activities</p>
                    <small>Plant care and management activities</small>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon sensor-icon">
                    <i class="fas fa-thermometer-half"></i>
                </div>
                <div class="stat-info">
                    <h3>{{ export_stats.total_sensors }}</h3>
                    <p>Sensors</p>
                    <small>{{ export_stats.total_sensor_readings }} readings recorded</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Individual Data Exports -->
    <div class="export-section">
        <h2><i class="fas fa-file-export"></i> Individual Data Exports</h2>
        
        <div class="export-cards">
            <!-- Plants Export -->
            <div class="export-card">
                <div class="export-header">
                    <i class="fas fa-seedling"></i>
                    <h3>Plants Data</h3>
                </div>
                <p>Export all plant information including growing details, status, and harvest data.</p>
                <div class="export-actions">
                    <a href="{{ url_for('export_plants', format='csv') }}" class="btn btn-export csv-btn">
                        <i class="fas fa-file-csv"></i> CSV Format
                    </a>
                    <a href="{{ url_for('export_plants', format='json') }}" class="btn btn-export json-btn">
                        <i class="fas fa-file-code"></i> JSON Format
                    </a>
                </div>
            </div>

            <!-- Strains Export -->
            <div class="export-card">
                <div class="export-header">
                    <i class="fas fa-dna"></i>
                    <h3>Strains Data</h3>
                </div>
                <p>Export strain collection with genetics, seed counts, and breeder information.</p>
                <div class="export-actions">
                    <a href="{{ url_for('export_strains', format='csv') }}" class="btn btn-export csv-btn">
                        <i class="fas fa-file-csv"></i> CSV Format
                    </a>
                    <a href="{{ url_for('export_strains', format='json') }}" class="btn btn-export json-btn">
                        <i class="fas fa-file-code"></i> JSON Format
                    </a>
                </div>
            </div>

            <!-- Activities Export -->
            <div class="export-card">
                <div class="export-header">
                    <i class="fas fa-tasks"></i>
                    <h3>Activities Data</h3>
                </div>
                <p>Export all plant care activities including watering, feeding, and maintenance logs.</p>
                <div class="export-actions">
                    <a href="{{ url_for('export_activities') }}" class="btn btn-export csv-btn">
                        <i class="fas fa-file-csv"></i> CSV Format
                    </a>
                </div>
            </div>

            <!-- Sensors Export -->
            <div class="export-card">
                <div class="export-header">
                    <i class="fas fa-thermometer-half"></i>
                    <h3>Sensors Data</h3>
                </div>
                <p>Export sensor configurations and latest environmental readings.</p>
                <div class="export-actions">
                    <a href="{{ url_for('export_sensors') }}" class="btn btn-export csv-btn">
                        <i class="fas fa-file-csv"></i> CSV Format
                    </a>
                </div>
            </div>

            <!-- Users Export -->
            <div class="export-card">
                <div class="export-header">
                    <i class="fas fa-users"></i>
                    <h3>Users Data</h3>
                </div>
                <p>Export user accounts and administrative information (admin only).</p>
                <div class="export-actions">
                    <a href="{{ url_for('export_users') }}" class="btn btn-export csv-btn">
                        <i class="fas fa-file-csv"></i> CSV Format
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Complete Backup Section -->
    <div class="backup-section">
        <h2><i class="fas fa-archive"></i> Complete System Backup</h2>
        
        <div class="backup-card">
            <div class="backup-info">
                <div class="backup-icon">
                    <i class="fas fa-database"></i>
                </div>
                <div class="backup-details">
                    <h3>Full System Backup</h3>
                    <p>Create a comprehensive backup containing all your CultivAR data in multiple formats. Includes plants, strains, activities, users, sensors, and system metadata.</p>
                    <ul class="backup-includes">
                        <li><i class="fas fa-check"></i> All plants data (CSV + JSON)</li>
                        <li><i class="fas fa-check"></i> Complete strain collection (CSV + JSON)</li>
                        <li><i class="fas fa-check"></i> Activity logs and history</li>
                        <li><i class="fas fa-check"></i> User accounts and permissions</li>
                        <li><i class="fas fa-check"></i> Sensor configurations and readings</li>
                        <li><i class="fas fa-check"></i> System metadata and timestamps</li>
                    </ul>
                </div>
            </div>
            <div class="backup-action">
                <a href="{{ url_for('export_complete') }}" class="btn btn-backup" onclick="showBackupProgress()">
                    <i class="fas fa-download"></i> Create Complete Backup
                </a>
                <p class="backup-note">This may take a few moments for large datasets</p>
            </div>
        </div>
    </div>

    <!-- Export Information -->
    <div class="info-section">
        <h2><i class="fas fa-info-circle"></i> Export Information</h2>
        
        <div class="info-cards">
            <div class="info-card">
                <h4><i class="fas fa-file-csv"></i> CSV Format</h4>
                <p>Comma-separated values format, perfect for spreadsheet applications like Excel, Google Sheets, or data analysis tools. Human-readable and widely supported.</p>
            </div>
            
            <div class="info-card">
                <h4><i class="fas fa-file-code"></i> JSON Format</h4>
                <p>JavaScript Object Notation format, ideal for developers and system integrations. Preserves data structure and relationships between records.</p>
            </div>
            
            <div class="info-card">
                <h4><i class="fas fa-archive"></i> Complete Backup</h4>
                <p>ZIP archive containing all data in multiple formats with metadata. Perfect for full system restoration, migration, or comprehensive data archiving.</p>
            </div>
        </div>
    </div>
</div>

<!-- Progress Modal -->
<div id="progressModal" class="modal">
    <div class="modal-content">
        <div class="progress-info">
            <i class="fas fa-cog fa-spin"></i>
            <h3>Creating Backup...</h3>
            <p>Please wait while we prepare your complete system backup.</p>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>
</div>

<style>
.export-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.stats-section, .export-section, .backup-section, .info-section {
    margin-bottom: 40px;
}

.stats-section h2, .export-section h2, .backup-section h2, .info-section h2 {
    color: #4CAF50;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.5rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: linear-gradient(145deg, #2a2a2a, #3a3a3a);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.2);
}

.stat-icon {
    font-size: 2.5rem;
    margin-right: 15px;
    width: 60px;
    text-align: center;
}

.plant-icon { color: #4CAF50; }
.strain-icon { color: #9C27B0; }
.activity-icon { color: #FF9800; }
.sensor-icon { color: #2196F3; }

.stat-info h3 {
    font-size: 2rem;
    font-weight: bold;
    color: #fff;
    margin: 0;
}

.stat-info p {
    color: #bbb;
    margin: 5px 0;
    font-size: 0.9rem;
}

.stat-info small {
    color: #888;
    font-size: 0.8rem;
}

.export-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.export-card {
    background: linear-gradient(145deg, #2a2a2a, #3a3a3a);
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.2);
    transition: transform 0.3s ease;
}

.export-card:hover {
    transform: translateY(-5px);
}

.export-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}

.export-header i {
    font-size: 1.5rem;
    color: #4CAF50;
}

.export-header h3 {
    color: #fff;
    margin: 0;
    font-size: 1.2rem;
}

.export-card p {
    color: #bbb;
    margin-bottom: 20px;
    line-height: 1.5;
}

.export-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.btn-export {
    flex: 1;
    min-width: 120px;
    padding: 10px 15px;
    border-radius: 8px;
    border: none;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 0.9rem;
}

.csv-btn {
    background: linear-gradient(145deg, #4CAF50, #66BB6A);
    color: white;
    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
}

.csv-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
}

.json-btn {
    background: linear-gradient(145deg, #FF9800, #FFB74D);
    color: white;
    box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
}

.json-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(255, 152, 0, 0.4);
}

.backup-card {
    background: linear-gradient(145deg, #2a2a2a, #3a3a3a);
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.2);
    display: flex;
    align-items: center;
    gap: 30px;
}

.backup-info {
    flex: 1;
    display: flex;
    gap: 20px;
}

.backup-icon {
    font-size: 3rem;
    color: #4CAF50;
}

.backup-details h3 {
    color: #fff;
    margin: 0 0 10px 0;
    font-size: 1.3rem;
}

.backup-details p {
    color: #bbb;
    margin-bottom: 15px;
    line-height: 1.5;
}

.backup-includes {
    list-style: none;
    padding: 0;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 5px;
}

.backup-includes li {
    color: #ddd;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.backup-includes i {
    color: #4CAF50;
    font-size: 0.8rem;
}

.backup-action {
    text-align: center;
}

.btn-backup {
    background: linear-gradient(145deg, #4CAF50, #66BB6A);
    color: white;
    padding: 15px 30px;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    font-size: 1.1rem;
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
    margin-bottom: 10px;
}

.btn-backup:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
}

.backup-note {
    color: #888;
    font-size: 0.85rem;
    margin: 0;
    font-style: italic;
}

.info-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.info-card {
    background: linear-gradient(145deg, #333, #2a2a2a);
    border-radius: 8px;
    padding: 20px;
    border: 1px solid #444;
}

.info-card h4 {
    color: #4CAF50;
    margin: 0 0 10px 0;
    display: flex;
    align-items: center;
    gap: 8px;
}

.info-card p {
    color: #bbb;
    margin: 0;
    line-height: 1.5;
    font-size: 0.9rem;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
}

.modal-content {
    background: linear-gradient(145deg, #2a2a2a, #3a3a3a);
    margin: 15% auto;
    padding: 30px;
    border-radius: 12px;
    width: 400px;
    text-align: center;
    border: 1px solid rgba(76, 175, 80, 0.2);
}

.progress-info i {
    font-size: 3rem;
    color: #4CAF50;
    margin-bottom: 20px;
}

.progress-info h3 {
    color: #fff;
    margin-bottom: 10px;
}

.progress-info p {
    color: #bbb;
    margin-bottom: 20px;
}

.progress-bar {
    width: 100%;
    height: 6px;
    background: #444;
    border-radius: 3px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #66BB6A);
    animation: progress 2s ease-in-out infinite;
}

@keyframes progress {
    0% { width: 0%; }
    50% { width: 70%; }
    100% { width: 100%; }
}

/* Responsive design */
@media (max-width: 768px) {
    .export-container {
        padding: 15px;
    }
    
    .backup-card {
        flex-direction: column;
        text-align: center;
    }
    
    .backup-includes {
        grid-template-columns: 1fr;
    }
    
    .export-actions {
        flex-direction: column;
    }
    
    .btn-export {
        min-width: auto;
    }
}
</style>

<script>
function showBackupProgress() {
    const modal = document.getElementById('progressModal');
    modal.style.display = 'block';
    
    // Hide modal after 3 seconds (backup should start downloading)
    setTimeout(() => {
        modal.style.display = 'none';
    }, 3000);
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('progressModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}
</script>

{% endblock %}